<!doctype html><html><head><title>程序员的远程办公解决方案 | Andrew&#39;s Blog</title><meta charset=utf-8><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content><meta name=keywords content><meta name=author content><meta property=og:title content=程序员的远程办公解决方案><meta property=og:description content><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:url content=https://apemost.com/articles/2020/03/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%BF%9C%E7%A8%8B%E5%8A%9E%E5%85%AC%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/><link href rel=alternate type=application/rss+xml title="Andrew's Blog"><link rel="shortcut icon" href=https://apemost.com/favicon.png><link rel=stylesheet href=https://apemost.com/css/style.css><meta name=generator content="Hugo 0.53"></head><body><div id=container><header id=header><div id=header-outer class=outer><div id=header-inner class=inner><a id=main-nav-toggle class=nav-icon href=javascript:;></a><a id=logo class=logo-text href=https://apemost.com>Andrew&#39;s Blog</a><nav id=main-nav><a class=main-nav-link href=https://apemost.com/articles/>Articles</a>
<a class=main-nav-link href=https://apemost.com/tags/>Tags</a>
<a class=main-nav-link href=https://github.com/apemost>GitHub</a></nav><nav id=sub-nav><div id=search-form-wrap></div></nav></div></div></header><section id=main class=outer><article class="article article-type-post" itemscope itemprop=blogPost><div class=article-inner><header class=article-header><h1 class=article-title itemprop=name>程序员的远程办公解决方案</h1></header><div class=article-meta><span class=article-date><time datetime=2020-03-21T13:09:44.000&#43;08:00 itemprop=datePublished>Mar 21, 2020</time></span><div class=post-categories><div class=article-category><a class=article-category-link href=https://apemost.com/categories/technology>Technology</a></div></div></div><div class=article-entry itemprop=articleBody><p><img src="https://images.pexels.com/photos/3740632/pexels-photo-3740632.jpeg?auto=compress&amp;cs=tinysrgb&amp;h=750&amp;w=1260" alt></p><p>近期新型冠狀病毒影响了大家的生活和工作，这篇博文将教大家怎么以正确的姿势开启远程办公。</p><h2 id=开始>开始</h2><p>由于我的 Linux 主机在公司，手头上的 MBP 性能又不太行，在家办公的时候，就需要远程到公司的主机上。为了解决这个需求，开始 Hack。</p><h3 id=配置-frps>配置 frps</h3><p>在公网主机上创建目录及 <code>frps.ini</code> 配置文件</p><pre><code class=language-bash>mkdir -p /opt/data/docker/snowdreamtech/frps
touch /opt/data/docker/snowdreamtech/frps/frps.ini
</code></pre><p>编辑 <code>frps.ini</code></p><pre><code class=language-ini>[common]
bind_port = 17000
token = yourtoken
</code></pre><p>运行 <code>frps</code> 容器</p><pre><code class=language-bash>docker run -d \
  --name frps \
  --restart always \
  --network host \
  -v /opt/data/docker/snowdreamtech/frps:/etc/frp \
  snowdreamtech/frps:0.31.1
</code></pre><h3 id=配置-frpc>配置 frpc</h3><p>在内网主机上创建目录及 <code>frpc.ini</code> 配置文件</p><pre><code class=language-bash>mkdir -p /opt/data/docker/snowdreamtech/frpc
touch /opt/data/docker/snowdreamtech/frpc/frpc.ini
</code></pre><p>编辑 <code>frpc.ini</code></p><pre><code class=language-ini>[common]
# 修改成你的公网域名或 IP
server_addr = jump.apemost.com
server_port = 17000
token = yourtoken

[ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remote_port = 16000
</code></pre><p>运行 <code>frpc</code> 容器</p><pre><code class=language-bash>docker run -d \
  --name frpc \
  --restart always \
  --network host \
  -v /opt/data/docker/snowdreamtech/frpc:/etc/frp \
  snowdreamtech/frpc:0.31.1
</code></pre><h3 id=配置-ssh>配置 SSH</h3><p>为了避免拉取或签入代码的时候经常输入密码，需要配置 <code>ForwardAgent yes</code>。如果你的 SSH 私钥没有设置密码，则不用设置 <code>ForwardAgent</code>。</p><p>编辑 <code>~/.ssh/config</code>，添加以下配置</p><pre><code class=language-sshconfig>Host apemost.remote
  HostName jump.apemost.com
  Port 16000
  ForwardAgent yes
</code></pre><h3 id=配置-gpg>配置 GPG</h3><p>因为我使用 <code>GPG</code> 签名 git commits，所以也为了避免频繁输入 <code>GPG</code> 私钥密码（默认是 10 分钟），需要配置 <code>~/.gnupg/gpg-agent.conf</code>。</p><p>设置 <code>default-cache-ttl</code> 为 1 天，<code>max-cache-ttl</code> 为 7 天</p><pre><code class=language-conf>default-cache-ttl 86400
max-cache-ttl 604800
</code></pre><p>检查 options 并重启 <code>gpg-agent</code></p><pre><code class=language-bash>gpgconf --list-options gpg-agent
gpgconf --reload gpg-agent
</code></pre><h3 id=远程编码>远程编码</h3><p>对于 <code>Python</code>，<code>Go</code> 等编程工作，直接终端编辑器如 <code>VIM</code> 即可。对于 <code>Java</code> 这种比较依赖 IDE 的，就需要进一步了。</p><p>开启 X11 转发</p><pre><code class=language-bash>ssh -Y apemost.remote
</code></pre><p>打开 <code>IntelliJ IDEA</code>，开始 coding</p><pre><code class=language-bash>idea
</code></pre><h2 id=结语>结语</h2><p>到这里我们就以正确的姿势开启了远程办公。</p><h2 id=references>References</h2><ul><li><a href=https://github.com/fatedier/frp>https://github.com/fatedier/frp</a></li><li><a href=https://stackoverflow.com/questions/12257968/how-to-forward-local-keypair-in-a-ssh-session>https://stackoverflow.com/questions/12257968/how-to-forward-local-keypair-in-a-ssh-session</a></li><li><a href=https://help.github.com/articles/signing-commits-using-gpg/>https://help.github.com/articles/signing-commits-using-gpg/</a></li><li><a href=https://superuser.com/questions/624343/keep-gnupg-credentials-cached-for-entire-user-session>https://superuser.com/questions/624343/keep-gnupg-credentials-cached-for-entire-user-session</a></li></ul></div><div class=article-toc style=display:none><h3>Contents</h3><nav id=TableOfContents><ul><li><ul><li><a href=#开始>开始</a><ul><li><a href=#配置-frps>配置 frps</a></li><li><a href=#配置-frpc>配置 frpc</a></li><li><a href=#配置-ssh>配置 SSH</a></li><li><a href=#配置-gpg>配置 GPG</a></li><li><a href=#远程编码>远程编码</a></li></ul></li><li><a href=#结语>结语</a></li><li><a href=#references>References</a></li></ul></li></ul></nav></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.slim.min.js integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc=" crossorigin=anonymous></script><script>(function(){var $toc=$('#TableOfContents');if($toc.length>0){var $window=$(window);function onScroll(){var currentScroll=$window.scrollTop();var h=$('.article-entry h1, .article-entry h2, .article-entry h3, .article-entry h4, .article-entry h5, .article-entry h6');var id="";h.each(function(i,e){e=$(e);if(e.offset().top-10<=currentScroll){id=e.attr('id');}});var active=$toc.find('a.active');if(active.length==1&&active.eq(0).attr('href')=='#'+id)return true;active.each(function(i,e){$(e).removeClass('active').siblings('ul').hide();});$toc.find('a[href="#'+id+'"]').parentsUntil('#TableOfContents').each(function(i,e){$(e).children('a').addClass('active').siblings('ul').show();});}
$window.on('scroll',onScroll);$(document).ready(function(){$toc.find('a').parent('li').find('ul').hide();onScroll();document.getElementsByClassName('article-toc')[0].style.display='';});}})();</script><footer class=article-footer><ul class=article-tag-list><li class=article-tag-list-item><a class=article-tag-list-link href=https://apemost.com/tags/ssh>ssh</a></li><li class=article-tag-list-item><a class=article-tag-list-link href=https://apemost.com/tags/frp>frp</a></li><li class=article-tag-list-item><a class=article-tag-list-link href=https://apemost.com/tags/gpg>gpg</a></li></ul></footer></div><nav id=article-nav><a href=https://apemost.com/articles/2019/01/%E6%A0%91%E8%8E%93%E6%B4%BE%E6%9B%B4%E6%96%B0%E6%BA%90%E4%BD%BF%E7%94%A8%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F/ id=article-nav-older class=article-nav-link-wrap><div class=article-nav-title>树莓派更新源使用阿里云镜像&nbsp;<span>&gt;</span></div></a></nav></article></section><footer id=footer><div class=outer><div id=footer-info class=inner>&copy; 2020 Andrew Lyu<br>Powered by <a href=https://gohugo.io target=_blank>Hugo</a> with theme <a href=https://github.com/carsonip/hugo-theme-minos target=_blank>Minos</a></div></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-99568791-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/tomorrow-night.min.css integrity="sha256-2wL88NKUqvJi/ExflDzkzUumjUM73mcK2gBvBBeLvTk=" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js integrity="sha256-KbfTjB0WZ8vvXngdpJGY3Yp3xKk+tttbqClO11anCIU=" crossorigin=anonymous></script><script>hljs.initHighlightingOnLoad();</script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css integrity=sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0 crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js integrity=sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1 crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js integrity="sha256-ExtbCSBuYA7kq1Pz362ibde9nnsHYPt6JxuxYeZbU+c=" crossorigin=anonymous></script><script>renderMathInElement(document.body);</script><script>document.getElementById('main-nav-toggle').addEventListener('click',function(){var header=document.getElementById('header');if(header.classList.contains('mobile-on')){header.classList.remove('mobile-on');}else{header.classList.add('mobile-on');}});</script></footer></div></body></html>